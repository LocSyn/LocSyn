# Location Synthesizer for Anonymization Contests
This is a source code of a location synthesizer a location trace anonymization contest. The location synthesizer is implemented with Python. A training algorithm is also implemented with C++, which is much faster than the Python version. This software is released under the MIT License.

# Directory Structure
- cpp/			&emsp;C++ codes (put the required files under this directory; see cpp/README.md).
- data/			&emsp;Output data (obtained by running codes).
  - PF/			&emsp;Output data in PF (SNS-based people flow data).
  - PF_dataset/		&emsp;Place PF (SNS-based people flow data) in this directory (currently empty).
  - FS/			&emsp;Output data in FS (Foursquare dataset).
  - FS_dataset/		&emsp;Place FS (Foursquare dataset) in this directory (currently empty).
- python/		&emsp;Python codes.

# Usage

**(1) Install**

Install Eigen 3.3.7, Generalized Constant Expression Math, and StatsLib (see cpp/README.md).

Install PPMTF (C++) as follows.
```
$ cd cpp/
$ make
$ cd ../
```

**(2) Download and preprocess PF**

Download the [SNS-based people flow data](https://nightley.jp/archives/1954/) and place the dataset in data/PF_dataset/.

Run the following commands.

```
$ cd python/
$ python3 Read_PF.py data/PF_dataset TK
$ cd ../
```

Then the POI file (POI_TK.csv) and the trace file (traces_TK.csv) are output in data/PF/.

**(3) Synthesizing traces in PF using PPMTF**

Run the following commands.

```
$ cd python/
$ python3 MakeTrainTestData_PF.py TK
$ python3 MakeTrainTensor.py PF TK
$ cd ../cpp/
$ ./PPMTF PF TK 200
(To change the alpha paramter from 200 to [alpha], run "./PPMTF PF TK [alpha]".)
$ cd ../python/
$ python3 SampleParamA.py PF TK
$ cd ../
```

Then a generative model for teams 1 to 10 (modelparameter_Itr100_SmplA[1-10].csv) will be generated in data/PF/PPMTF_TK_alp200_mnt100_mnv100/.

To generate a synthetic trace of team 1, run the following commands.

```
$ cd cpp/
$ ./SynData_PPMTF PF TK 10 SmplA1 200
(To change the team number from 1 to [t], run "./SynData_PPMTF PF TK 10 SamplA[t] 200".)
$ cd ../
```

Then synthesize traces (syntraces_Itr100_SmplA1.csv) will be generated in data/PF/PPMTF_TK_alp200_mnt100_mnv100/.

**(4) Download and preprocess FS**

Download the [Foursquare dataset (Global-scale Check-in Dataset with User Social Networks)](https://sites.google.com/site/yangdingqi/home/foursquare-dataset) and place the dataset in data/FS_dataset/.

Run the following command to fix garbled text.

```
$ cd data/FS_dataset/
$ cat raw_POIs.txt | sed -e "s/Caf[^.]*\t/Caf\t/" > raw_POIs_fix.txt
$ cd ../
```

Run the following commands.

```
$ cd python/
$ python3 Read_FS.py data/FS_dataset/ NY
$ cd ../
```

Then the POI file (POI_NY.csv) and the trace file (traces_NY.csv) are output in data/PF/.

The POI file and trace file in other cities (IST/JK/KL/SP/TKY) can also be generated by replacing NY with IS, JK, KL, SP, or TK.

**(5) Synthesizing traces in FS using PPMTF**

Run the following commands.

```
$ cd python/
$ python3 MakeTrainTestData_FS.py NY
$ python3 MakeTrainTensor.py PF NY
$ cd ../cpp/
$ ./PPMTF FS NY 200
$ cd ../python/
$ python3 SampleParamA.py FS NY
$ cd ../
```
Then a generative model for teams 1 to 10 (modelparameter_Itr100_SmplA[1-10].csv) will be generated in data/FS/PPMTF_NY_alp200_mnt100_mnv100/.

To generate a synthetic trace of team 1, run the following commands.

```
$ cd cpp/
$ ./SynData_PPMTF FS NY 20 SmplA1 200
(To change the team number from 1 to [t], run "./SynData_PPMTF PF TK 20 SamplA[t] 200".)
$ cd ../
```

Then synthesize traces (syntraces_Itr100_SmplA1.csv) in NYC will be generated in data/FS/PPMTF_NY_alp200_mnt100_mnv100/.

Synthesized traces in other cities (IST/JK/KL/SP/TKY) can also be generated and evaluated by replacing NY with IS, JK, KL, SP, or TK.

# Execution Environment
We used CentOS 7.5 with gcc 4.8.5 and python 3.6.5.

# External Libraries used by PPMTF
- [Eigen 3.3.7](http://eigen.tuxfamily.org/index.php?title=Main_Page) is distributed under the [MPL2](https://www.mozilla.org/en-US/MPL/2.0/).
- [Generalized Constant Expression Math](https://www.kthohr.com/gcem.html) is distributed under the [Apache License 2.0](https://github.com/kthohr/stats/blob/master/LICENSE).
- [StatsLib](https://www.kthohr.com/statslib.html) is distributed under the [Apache License 2.0](https://github.com/kthohr/stats/blob/master/LICENSE).
